import{g as K,h as ke,d as Re,c as Ie,a as c,b as L,f as p,s as k}from"../chunks/pWOMhstZ.js";import{t as R,H as Z,Q as ee,l as Se,at as je,W as te,X as ze,af as Ce,au as Ee,av as Me,N as Oe,O as T,p as Ae,u as Te,f as F,a as Fe,e as ae,b as Ge,c as o,s as d,r as s,g as t,h as Q}from"../chunks/BepynHdk.js";import{i as C,a as G,s as Pe}from"../chunks/CaLNNbA5.js";import{e as se,i as re}from"../chunks/9pRRSWtK.js";import{s as ne}from"../chunks/DkQQvypr.js";import{x as De,s as U,y as oe,p as He,i as ie,z as We}from"../chunks/DEoDEiov.js";import{a as V,b as P}from"../chunks/Gq__uSar.js";function qe(D,H,$=!1,i=!1,y=!1){var h=D,v="";R(()=>{var w=Se;if(v===(v=H()??"")){Z&&ee();return}if(w.nodes!==null&&(je(w.nodes.start,w.nodes.end),w.nodes=null),v!==""){if(Z){te.data;for(var a=ee(),E=a;a!==null&&(a.nodeType!==ze||a.data!=="");)E=a,a=Ce(a);if(a===null)throw Ee(),Me;K(te,E),h=Oe(a);return}var g=v+"";$?g=`<svg>${g}</svg>`:i&&(g=`<math>${g}</math>`);var f=ke(g);if(($||i)&&(f=T(f)),K(T(f),f.lastChild),$||i)for(;T(f);)h.before(T(f));else h.before(f)}})}var Le=p("<button> </button>"),Qe=p("<button></button>"),Ue=p('| <span class="text-error"> </span>',1),Ve=p('<div class="flex gap-4 mb-4 text-xs text-text-secondary"><span> </span> <span> </span> <span> </span></div>'),Xe=p('<div class="flex items-center gap-4 mb-4"><div class="flex gap-1"></div> <div class="text-xs text-text-secondary"> <!></div></div> <!> <div class="bg-white rounded-lg p-4 overflow-auto max-h-[500px]"><!></div>',1),Ye=p('<div class="flex gap-2 mb-4"></div> <!>',1),Be=p('<p class="text-text-secondary">Click "Nest All Parts" to arrange parts on sheets.</p>'),Je=p('<div><div class="flex items-center justify-between mb-4"><h1 class="text-2xl font-bold">Nesting</h1> <button class="px-4 py-2 text-sm bg-accent hover:bg-accent/80 text-white rounded">Nest All Parts</button></div> <!></div>'),Ke=p('<div class="text-text-secondary"><p>No project loaded. <a href="/" class="text-accent hover:underline">Go home</a> to create or open one.</p></div>');function ot(D,H){Ae(H,!0);const $=()=>G(He,"$project",v),i=()=>G(V,"$selectedMaterialIndex",v),y=()=>G(P,"$selectedSheetIndex",v),h=()=>G(oe,"$nestingResults",v),[v,w]=Pe();let a=Ge("");async function E(){if($())try{ie.set(!0);const e=await We();oe.set(e),V.set(0),P.set(0),e.length>0&&await g(),U(`Nested onto ${e.reduce((m,I)=>m+I.nesting_result.sheet_count,0)} sheet(s)`,"success")}catch(e){U(`Error: ${e}`,"error")}finally{ie.set(!1)}}async function g(){try{ae(a,await De(i(),y()),!0)}catch(e){ae(a,""),U(`Error loading SVG: ${e}`,"error")}}Te(()=>{h().length>0&&g()});const f=Q(()=>h()[i()]),x=Q(()=>{var e;return(e=t(f))==null?void 0:e.nesting_result});var X=Ie(),le=F(X);{var ce=e=>{var m=Je(),I=o(m),ve=d(o(I),2);s(I);var fe=d(I,2);{var _e=N=>{var M=Ye(),W=F(M);se(W,5,h,re,(S,j,_)=>{var u=Le();let z;var O=o(u);s(u),R(()=>{z=ne(u,1,"px-3 py-1 text-xs rounded",null,z,{"bg-accent":i()===_,"text-white":i()===_,"bg-surface":i()!==_,"hover:bg-surface-hover":i()!==_}),k(O,`${t(j).material_name??""} (${t(j).thickness??""}")`)}),L("click",u,()=>{V.set(_),P.set(0)}),c(S,u)}),s(W);var pe=d(W,2);{var he=S=>{var j=Xe(),_=F(j),u=o(_);se(u,21,()=>t(x).sheets,re,(r,b,n)=>{var l=Qe();let A;l.textContent=`Sheet ${n+1}`,R(()=>A=ne(l,1,"px-2 py-1 text-xs rounded",null,A,{"bg-surface-hover":y()===n,"bg-surface":y()!==n})),L("click",l,()=>P.set(n)),c(r,l)}),s(u);var z=d(u,2),O=o(z),ge=d(O);{var xe=r=>{var b=Ue(),n=d(F(b)),l=o(n);s(n),R(()=>k(l,`${t(x).unplaced.length??""} unplaced`)),c(r,b)};C(ge,r=>{t(x).unplaced.length>0&&r(xe)})}s(z),s(_);var Y=d(_,2);{var me=r=>{const b=Q(()=>t(x).sheets[y()]);var n=Ve(),l=o(n),A=o(l);s(l);var q=d(l,2),$e=o(q);s(q);var J=d(q,2),ye=o(J);s(J),s(n),R((we,Ne)=>{k(A,`Parts: ${t(b).parts.length??""}`),k($e,`Utilization: ${we??""}%`),k(ye,`Waste: ${Ne??""} sq in`)},[()=>t(b).utilization.toFixed(1),()=>t(b).waste_area.toFixed(1)]),c(r,n)};C(Y,r=>{t(x).sheets[y()]&&r(me)})}var B=d(Y,2),be=o(B);qe(be,()=>t(a)),s(B),R(r=>k(O,`${t(x).sheet_count??""} sheet(s) | ${r??""}% utilization `),[()=>t(x).overall_utilization.toFixed(1)]),c(S,j)};C(pe,S=>{t(x)&&S(he)})}c(N,M)},ue=N=>{var M=Be();c(N,M)};C(fe,N=>{h().length>0?N(_e):N(ue,!1)})}s(m),L("click",ve,E),c(e,m)},de=e=>{var m=Ke();c(e,m)};C(le,e=>{$()?e(ce):e(de,!1)})}c(D,X),Fe(),w()}Re(["click"]);export{ot as component};
