import{g as K,d as Me,c as Se,a as d,b as V,f as p,s as w}from"../chunks/CyNfHtry.js";import{t as N,H as Z,Q as ee,l as Ae,at as Ee,W as te,X as ke,af as Re,au as Ce,av as Ie,N as Te,aw as je,ax as ze,ay as Oe,O as W,p as Pe,u as Ge,f as O,a as He,e as ae,b as Fe,c as l,s as v,r,g as e,h as q}from"../chunks/DUOIInB9.js";import{i as R,a as P,s as Le}from"../chunks/B22MubrG.js";import{e as se,i as re}from"../chunks/C2eLq_D0.js";import{s as ne}from"../chunks/D7iecON0.js";import{x as De,s as Q,y as oe,p as Ve,i as ie,z as We}from"../chunks/B-0l54sc.js";import{a as U,b as G}from"../chunks/neMrXvPf.js";function qe(H,F,g=!1,n=!1,b=!1){var h=H,_="";N(()=>{var y=Ae;if(_===(_=F()??"")){Z&&ee();return}if(y.nodes!==null&&(Ee(y.nodes.start,y.nodes.end),y.nodes=null),_!==""){if(Z){te.data;for(var s=ee(),C=s;s!==null&&(s.nodeType!==ke||s.data!=="");)C=s,s=Re(s);if(s===null)throw Ce(),Ie;K(te,C),h=Te(s);return}var I=g?ze:n?Oe:void 0,M=je(g?"svg":n?"math":"template",I);M.innerHTML=_;var t=g||n?M:M.content;if(K(W(t),t.lastChild),g||n)for(;W(t);)h.before(W(t));else h.before(t)}})}var Qe=p("<button> </button>"),Ue=p("<button></button>"),Xe=p('| <span class="text-error"> </span>',1),Ye=p('<div class="flex gap-4 mb-4 text-xs text-text-secondary"><span> </span> <span> </span> <span> </span></div>'),Be=p('<div class="flex items-center gap-4 mb-4"><div class="flex gap-1"></div> <div class="text-xs text-text-secondary"> <!></div></div> <!> <div class="bg-white rounded-lg p-4 overflow-auto max-h-[500px]"><!></div>',1),Je=p('<div class="flex gap-2 mb-4"></div> <!>',1),Ke=p('<p class="text-text-secondary">Click "Nest All Parts" to arrange parts on sheets.</p>'),Ze=p('<div><div class="flex items-center justify-between mb-4"><h1 class="text-2xl font-bold">Nesting</h1> <button class="px-4 py-2 text-sm bg-accent hover:bg-accent/80 text-white rounded">Nest All Parts</button></div> <!></div>'),et=p('<div class="text-text-secondary"><p>No project loaded. <a href="/" class="text-accent hover:underline">Go home</a> to create or open one.</p></div>');function lt(H,F){Pe(F,!0);const g=()=>P(Ve,"$project",_),n=()=>P(U,"$selectedMaterialIndex",_),b=()=>P(G,"$selectedSheetIndex",_),h=()=>P(oe,"$nestingResults",_),[_,y]=Le();let s=Fe("");async function C(){if(g())try{ie.set(!0);const a=await We();oe.set(a),U.set(0),G.set(0),a.length>0&&await I(),Q(`Nested onto ${a.reduce((x,S)=>x+S.nesting_result.sheet_count,0)} sheet(s)`,"success")}catch(a){Q(`Error: ${a}`,"error")}finally{ie.set(!1)}}async function I(){try{ae(s,await De(n(),b()),!0)}catch(a){ae(s,""),Q(`Error loading SVG: ${a}`,"error")}}Ge(()=>{h().length>0&&I()});const M=q(()=>h()[n()]),t=q(()=>e(M)?.nesting_result);var X=Se(),le=O(X);{var ce=a=>{var x=Ze(),S=l(x),ve=v(l(S),2);r(S);var _e=v(S,2);{var fe=$=>{var T=Je(),L=O(T);se(L,5,h,re,(A,E,f)=>{var u=Qe();let k;var j=l(u);r(u),N(()=>{k=ne(u,1,"px-3 py-1 text-xs rounded",null,k,{"bg-accent":n()===f,"text-white":n()===f,"bg-surface":n()!==f,"hover:bg-surface-hover":n()!==f}),w(j,`${e(E).material_name??""} (${e(E).thickness??""}")`)}),V("click",u,()=>{U.set(f),G.set(0)}),d(A,u)}),r(L);var pe=v(L,2);{var he=A=>{var E=Be(),f=O(E),u=l(f);se(u,21,()=>e(t).sheets,re,(o,m,i)=>{var c=Ue();let z;c.textContent=`Sheet ${i+1}`,N(()=>z=ne(c,1,"px-2 py-1 text-xs rounded",null,z,{"bg-surface-hover":b()===i,"bg-surface":b()!==i})),V("click",c,()=>G.set(i)),d(o,c)}),r(u);var k=v(u,2),j=l(k),ge=v(j);{var xe=o=>{var m=Xe(),i=v(O(m)),c=l(i);r(i),N(()=>w(c,`${e(t).unplaced.length??""} unplaced`)),d(o,m)};R(ge,o=>{e(t).unplaced.length>0&&o(xe)})}r(k),r(f);var Y=v(f,2);{var me=o=>{const m=q(()=>e(t).sheets[b()]);var i=Ye(),c=l(i),z=l(c);r(c);var D=v(c,2),ye=l(D);r(D);var J=v(D,2),$e=l(J);r(J),r(i),N((we,Ne)=>{w(z,`Parts: ${e(m).parts.length??""}`),w(ye,`Utilization: ${we??""}%`),w($e,`Waste: ${Ne??""} sq in`)},[()=>e(m).utilization.toFixed(1),()=>e(m).waste_area.toFixed(1)]),d(o,i)};R(Y,o=>{e(t).sheets[b()]&&o(me)})}var B=v(Y,2),be=l(B);qe(be,()=>e(s)),r(B),N(o=>w(j,`${e(t).sheet_count??""} sheet(s) | ${o??""}% utilization `),[()=>e(t).overall_utilization.toFixed(1)]),d(A,E)};R(pe,A=>{e(t)&&A(he)})}d($,T)},ue=$=>{var T=Ke();d($,T)};R(_e,$=>{h().length>0?$(fe):$(ue,!1)})}r(x),V("click",ve,C),d(a,x)},de=a=>{var x=et();d(a,x)};R(le,a=>{g()?a(ce):a(de,!1)})}d(H,X),He(),y()}Me(["click"]);export{lt as component};
